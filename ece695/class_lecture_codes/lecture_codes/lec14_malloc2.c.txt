// A simple example showing what happens before / after malloc() and free() 

#include <stdio.h>
#include <sys/time.h>

#define SIZE 1024*1024*512

int main()
{
  int i, *p1, *p2, *p3, *p4;

  sleep(10); // so we can watch top
 
  if ((p1 = (int *) malloc(SIZE)) != NULL)
    printf(" allocated %d bytes @ p1 = %p in page %p", SIZE,
	   p1, ((int) p1>>12)<<12);
    else
	printf("Could not allocate %d bytes\n", SIZE);
  sleep(20);

  printf("START WRITING !!!!!!!!!!\n");
  for(i=0;i<(SIZE>>2);i++)
    p1[i] = i*i*i*i;


  sleep(10);
  free(p1);
  printf("Freed !!!!!!!!!!!!!!!!!!!!!!!!\n"); 
  sleep(10);

  exit(0);
}


